<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>简版图片懒加载</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"
      rel="stylesheet"
    />
    <style>
      .image-container {
        margin: 2rem auto;
        max-width: 800px;
        padding: 1rem;
      }

      .lazy-image {
        width: 100%;
        height: 400px;
        margin-bottom: 4rem;
        background: #f0f0f0;
        border-radius: 8px;
        transition: opacity 0.3s ease-in-out;
      }

      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        color: #666;
      }

      .loaded {
        opacity: 1;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto p-4">
      <h1 class="text-3xl font-bold text-center my-8 text-gray-800">
        简版图片懒加载示例
      </h1>

      <div class="image-container">
        <!-- 使用data-src存储真实图片地址，src使用占位符 -->
        <img
          class="lazy-image loading"
          data-src="https://picsum.photos/800/400?random=1"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3C/svg%3E"
          alt="风景照片1"
        />

        <img
          class="lazy-image loading"
          data-src="https://picsum.photos/800/400?random=2"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3C/svg%3E"
          alt="风景照片2"
        />

        <img
          class="lazy-image loading"
          data-src="https://picsum.photos/800/400?random=3"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3C/svg%3E"
          alt="风景照片3"
        />

        <img
          class="lazy-image loading"
          data-src="https://picsum.photos/800/400?random=4"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3C/svg%3E"
          alt="风景照片4"
        />

        <img
          class="lazy-image loading"
          data-src="https://picsum.photos/800/400?random=5"
          src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 400'%3E%3C/svg%3E"
          alt="风景照片5"
        />
      </div>
    </div>

    <script>
      // 图片懒加载实现
      document.addEventListener("DOMContentLoaded", function () {
        // 检查浏览器是否支持IntersectionObserver
        if ("IntersectionObserver" in window) {
          lazyLoading_Obsrsver();
        } else {
          lazyLoading_Rect();
        }
      });

      function lazyLoading_Rect(preloadDistance = 100) {
        const images = document.querySelectorAll(".lazy-image");

        images.forEach((image) => {
          const rect = image.getBoundingClientRect();
          let top = rect.top;

          if (
            top + preloadDistance + rect.height > 0 &&
            top < window.innerHeight + preloadDistance
          ) {
            let src = image.getAttribute("data-src");

            if (src === null || src === "done") return;

            image.src = src;

            image.setAttribute("data-src", "done");
          }
        });
      }

      function lazyLoading_Obsrsver() {
        const images = document.querySelectorAll(".lazy-image");

        const observer = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting) {
                const image = entry.target;
                const src = image.getAttribute("data-src");

                if (src === null || src === "done")
                  return observer.unobserve(image);

                image.src = src;

                image.setAttribute("data-src", "done");

                observer.unobserve(image);
              }
            });
          },
          {
            threshold: 0,
            rootMargin: "0px 0px 100px 0px",
          }
        );

        images.forEach((image) => {
          observer.observe(image);
        });
      }
    </script>
  </body>
</html>
