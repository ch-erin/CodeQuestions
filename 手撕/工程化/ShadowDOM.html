<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow DOM 组件示例</title>
    <style>
      /* 全局样式 - 不会影响Shadow DOM内部 */
      body {
        font-family: Arial, sans-serif;
        padding: 2rem;
        max-width: 800px;
        margin: 0 auto;
      }

      .container {
        display: flex;
        flex-direction: column;
        gap: 2rem;
      }

      /* 这个样式不会影响shadow-button内部的button */
      button {
        background: red;
        color: white;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Shadow DOM 组件示例</h1>

      <!-- 原生button - 会被全局样式影响 -->
      <div>
        <h3>原生 button（受全局样式影响）</h3>
        <button>原生按钮</button>
      </div>

      <!-- 自定义Shadow Button组件 -->
      <div>
        <h3>Shadow Button（样式隔离）</h3>
        <shadow-button>基础阴影按钮</shadow-button>
        <shadow-button type="primary">主要阴影按钮</shadow-button>
        <shadow-button disabled>禁用阴影按钮</shadow-button>
      </div>

      <!-- 自定义Shadow Form组件 -->
      <div>
        <h3>Shadow Form（完整表单封装）</h3>
        <shadow-form></shadow-form>
      </div>
    </div>

    <script>
      // 1. 定义自定义Shadow Button组件
      class ShadowButton extends HTMLElement {
        constructor() {
          super();
          // 创建Shadow DOM
          const shadow = this.attachShadow({ mode: "open" });

          // 获取组件属性
          const type = this.getAttribute("type") || "default";
          const disabled = this.hasAttribute("disabled");

          // 创建按钮元素
          const button = document.createElement("button");
          button.textContent = this.textContent;
          button.disabled = disabled;

          // 创建样式（仅作用于当前Shadow DOM）
          const style = document.createElement("style");
          style.textContent = `
                    button {
                        padding: 8px 16px;
                        border: none;
                        border-radius: 4px;
                        cursor: pointer;
                        font-size: 14px;
                        transition: all 0.2s;
                    }
                    
                    button:disabled {
                        opacity: 0.6;
                        cursor: not-allowed;
                    }
                    
                    /* 不同类型按钮的样式 */
                    button.default {
                        background: #f0f0f0;
                        color: #333;
                    }
                    
                    button.primary {
                        background: #2196f3;
                        color: white;
                    }
                    
                    button:hover:not(:disabled) {
                        transform: translateY(-2px);
                        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                    }
                `;

          // 添加类名用于样式区分
          button.classList.add(type);

          // 将元素添加到Shadow DOM
          shadow.appendChild(style);
          shadow.appendChild(button);
        }
      }

      // 注册自定义元素
      customElements.define("shadow-button", ShadowButton);

      // 2. 定义自定义Shadow Form组件
      class ShadowForm extends HTMLElement {
        constructor() {
          super();
          // 创建Shadow DOM
          const shadow = this.attachShadow({ mode: "open" });

          // 创建表单结构
          const form = document.createElement("form");
          form.innerHTML = `
                    <div class="form-group">
                        <label>用户名:</label>
                        <input type="text" name="username" placeholder="请输入用户名">
                    </div>
                    <div class="form-group">
                        <label>密码:</label>
                        <input type="password" name="password" placeholder="请输入密码">
                    </div>
                    <div class="form-actions">
                        <shadow-button type="primary" id="submit">提交</shadow-button>
                        <shadow-button type="default" id="reset">重置</shadow-button>
                    </div>
                `;

          // 创建样式（仅作用于当前Shadow DOM）
          const style = document.createElement("style");
          style.textContent = `
                    form {
                        background: #f9f9f9;
                        padding: 20px;
                        border-radius: 8px;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    
                    .form-group {
                        margin-bottom: 16px;
                    }
                    
                    label {
                        display: block;
                        margin-bottom: 6px;
                        color: #666;
                        font-size: 14px;
                    }
                    
                    input {
                        width: 100%;
                        padding: 8px 12px;
                        border: 1px solid #ddd;
                        border-radius: 4px;
                        font-size: 14px;
                    }
                    
                    input:focus {
                        outline: none;
                        border-color: #2196f3;
                        box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
                    }
                    
                    .form-actions {
                        margin-top: 20px;
                        display: flex;
                        gap: 10px;
                    }
                `;

          // 添加表单事件处理
          form.addEventListener("submit", (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            alert(`表单提交:\n${JSON.stringify(data, null, 2)}`);
          });

          form.querySelector("#reset").addEventListener("click", () => {
            form.reset();
          });

          // 将元素添加到Shadow DOM
          shadow.appendChild(style);
          shadow.appendChild(form);
        }
      }

      // 注册自定义元素
      customElements.define("shadow-form", ShadowForm);
    </script>
  </body>
</html>
